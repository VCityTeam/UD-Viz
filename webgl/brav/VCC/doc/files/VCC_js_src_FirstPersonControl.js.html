<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>VCC/js/src/FirstPersonControl.js - Virtual City Client</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="Virtual City Client"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/FirstPersonControls.html">FirstPersonControls</a></li>
            
                <li><a href="../classes/VCC.Enum.html">VCC.Enum</a></li>
            
                <li><a href="../classes/VCC.Scheduler.html">VCC.Scheduler</a></li>
            
                <li><a href="../classes/VCC.SchedulerTask.html">VCC.SchedulerTask</a></li>
            
                <li><a href="../classes/VCC.TexturesManager.html">VCC.TexturesManager</a></li>
            
                <li><a href="../classes/VCC.Tile.html">VCC.Tile</a></li>
            
                <li><a href="../classes/VCC.TileManager.html">VCC.TileManager</a></li>
            
                <li><a href="../classes/VCC.ViewPort.html">VCC.ViewPort</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: VCC/js/src/FirstPersonControl.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * Camera movement contoler  
 * Modifed by Alexandre Vienne to call change lod method when displacing the camera 
 *
 * @class FirstPersonControls 
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 * @author paulirish / http://paulirish.com/
 */




 THREE.FirstPersonControls = function ( object, domElement ) {

 	this.object = object;
 	this.camRoot = new THREE.Object3D ();
 	this.target = new THREE.Vector3( 0, 0, 5 );

 	this.domElement = ( domElement !== undefined ) ? domElement : document;

 	this.movementSpeed = 10.0;
 	this.lookSpeed = 5;

 	this.lookVertical = true;
 	this.autoForward = false;
	// this.invertVertical = false;

	this.activeLook = true;

	this.heightSpeed = false;
	this.heightCoef = 1.0;
	this.heightMin = 0.0;
	this.heightMax = 1.0;

	this.constrainVertical = false;
	this.verticalMin = 0;
	this.verticalMax = Math.PI;

	this.autoSpeedFactor = 0.0;
	
	/** Handle camera orientation fromkeyboard */
	
	this.keyLookX=0;
	this.keyLookY = 0;
    
    /**------*/ 

	this.lat = 0;
	this.lon = 230;
	this.phi = 0;
	this.theta = 0;

	this.moveForward = false;
	this.moveBackward = false;
	this.moveLeft = false;
	this.moveRight = false;
	this.freeze = false;


	this.viewHalfX = 0;
	this.viewHalfY = 0;

	if ( this.domElement !== document ) {

		this.domElement.setAttribute( &#x27;tabindex&#x27;, -1 );

	}

	this.handleResize = function () {

		if ( this.domElement === document ) {

			this.viewHalfX = window.innerWidth / 2;
			this.viewHalfY = window.innerHeight / 2;

		} else {

			this.viewHalfX = this.domElement.offsetWidth / 2;
			this.viewHalfY = this.domElement.offsetHeight / 2;

		}

	};

	this.onKeyDown = function ( event ) {

		//event.preventDefault();

		switch ( event.keyCode ) {

			case 38: /*up*/
				this.keyLookY = -this.lookSpeed ;
				break;
			case 90: /*Z*/ 
				this.moveForward = true; 
				break;
			case 37: /*left*/
				this.keyLookX = -this.lookSpeed ;
				break;
			case 81: /*Q*/ 
				this.moveLeft = true; 
				break;
			case 40: /*down*/
				this.keyLookY = this.lookSpeed ;
				break;
			case 83: /*S*/ 
				this.moveBackward = true; 
				break;
			case 39: /*right*/
				this.keyLookX = this.lookSpeed ;
				break;
			case 68: /*D*/ 
				this.moveRight = true; 
				break;
			case 82: /*R*/ 
				this.moveUp = true; 
			    break;
			case 70: /*F*/ 
				this.moveDown = true; 
				break;
			case 81: /*Q*/ 
				this.freeze = !this.freeze; 
				 break;

		}

	};

	this.onKeyUp = function ( event ) {

		switch( event.keyCode ) {

			case 38: /*up*/
				this.keyLookY = 0 ;
				break;
			case 90: /*Z*/ 
				this.moveForward = false; 
				break;
			case 37: /*left*/
				this.keyLookX = 0 ;
				break;
			case 81: /*Q*/ 
				this.moveLeft = false; 
				break;
			case 40: /*down*/
				this.keyLookY = 0 ;
				break;
			case 83: /*S*/ 
				this.moveBackward = false; 
				break;
			case 39: /*right*/
				this.keyLookX = 0 ;
				break;
			case 68: /*D*/ 
				this.moveRight = false; 
				break;

			case 82: /*R*/ 
				this.moveUp = false; 
				break;
			case 70: /*F*/ 
				this.moveDown = false;
				break;

		}

	};
	
	this.update = function( delta ) {

		if ( this.freeze ) {

			return;

		}

		if ( this.heightSpeed ) {

			var y = THREE.Math.clamp( this.object.position.y, this.heightMin, this.heightMax );
			var heightDelta = y - this.heightMin;

			this.autoSpeedFactor = delta * ( heightDelta * this.heightCoef );

		} else {

			this.autoSpeedFactor = 0.0;

		}

		var actualMoveSpeed = delta * this.movementSpeed;
		var actualY = this.object.position.y; 

		if ( this.moveForward || ( this.autoForward &amp;&amp; !this.moveBackward ) ){
		 this.object.translateZ( - ( actualMoveSpeed + this.autoSpeedFactor ) );
		 this.object.position.y = actualY;
		 VCC.ViewPort.tileManager.lodChange();
		}
		if ( this.moveBackward ){
			this.object.translateZ( actualMoveSpeed );
			this.object.position.y = actualY;
			VCC.ViewPort.tileManager.lodChange();
		}
		if ( this.moveLeft ) this.object.translateX( - actualMoveSpeed );
		if ( this.moveRight ) this.object.translateX( actualMoveSpeed );

		if ( this.moveUp ) this.object.translateY( actualMoveSpeed );
		if ( this.moveDown ) this.object.translateY( - actualMoveSpeed );

		var actualLookSpeed = delta * this.lookSpeed;

		if ( !this.activeLook ) {

			actualLookSpeed = 0;

		}

		var verticalLookRatio = 1;

		if ( this.constrainVertical ) {

			verticalLookRatio = Math.PI / ( this.verticalMax - this.verticalMin );

		}

		this.lon += this.keyLookX * actualLookSpeed;
		if( this.lookVertical ) this.lat -= this.keyLookY * actualLookSpeed * verticalLookRatio;

		this.lat = Math.max( - 85, Math.min( 85, this.lat ) );
		this.phi = THREE.Math.degToRad( 90 - this.lat );

		this.theta = THREE.Math.degToRad( this.lon );

		if ( this.constrainVertical ) {

			this.phi = THREE.Math.mapLinear( this.phi, 0, Math.PI, this.verticalMin, this.verticalMax );

		}

		var targetPosition = this.target,
		position = this.object.position;

		targetPosition.x = position.x + 100 * Math.sin( this.phi ) * Math.cos( this.theta );
		targetPosition.y = position.y + 100 * Math.cos( this.phi );
		targetPosition.z = position.z + 100 * Math.sin( this.phi ) * Math.sin( this.theta );
		this.object.lookAt( targetPosition );

		if(this.moveBackward || this.moveLeft || this.moveRight || this.moveForward){
			VCC.ViewPort.tileManager.tilePriorityManager();
		}

	};


	this.domElement.addEventListener( &#x27;contextmenu&#x27;, function ( event ) { event.preventDefault(); }, false );

	window.addEventListener( &#x27;keydown&#x27;, bind( this, this.onKeyDown ), false );
	window.addEventListener( &#x27;keyup&#x27;, bind( this, this.onKeyUp ), false );

	function bind( scope, fn ) {

		return function () {

			fn.apply( scope, arguments );

		};

	};

	this.handleResize();

};


    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
